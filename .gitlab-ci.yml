stages:
  - triggers
  - backend_unit
  - backend_integration
  - backend_full_lifecycle
  - frontend

# The pipeline covers a series of triggers to ensure full testing and coverage.

# Trigger Backend Setup for Non-Development Branches
conditional_non_development_backend:
  stage: triggers
  trigger:
    include: tools/pipelines/backend/child-ci-setup-pre-dev.yml
  rules:
    - if: $CI_COMMIT_REF_NAME != "development" && $CI_COMMIT_REF_NAME != "main" && $CI_COMMIT_REF_NAME != "qa" && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME != "development"
      when: always
    - when: never  # Ensures this doesn't run if no condition matches

# Trigger Backend Setup for Development Merges
conditional_development_backend_merge:
  stage: triggers
  trigger:
    include: tools/pipelines/backend/child-ci-setup-pre-dev.yml
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event" && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "development"
      when: always
     # Run for direct push to 'development' only if user is a maintainer or owner
    - if: $CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_BRANCH == "development" && ($GITLAB_USER_ACCESS_LEVEL == "Maintainer" || $GITLAB_USER_ACCESS_LEVEL == "Owner")
      when: always
    - when: never  # Ensures this doesn't run if no condition matches

# Unit Tests for Backend (Dev)
#unit_test_dev:
#  stage: backend_unit
#  trigger:
#    include: tools/pipelines/backend/child-ci-unit-tests-pre-dev.yml

# Integration Tests for Backend (Dev)
# integration_test_dev:
#  stage: backend_integration
#  trigger:
#    include: tools/pipelines/backend/child-ci-integration-tests-dev.yml

# Full Lifecycle Tests for Backend (Dev)
#full_lifecycle_dev:
#  stage: backend_full_lifecycle
#  trigger:
#    include: tools/pipelines/backend/child-ci-full-lifecycle-dev.yml

# Frontend Integration Tests (Run Simultaneously After Full Lifecycle)
# dart_web_integration_test_dev:
#   stage: frontend
#   trigger:
#     include: tools/pipelines/frontend/child-ci-dart-web-integration-test-dev.yml

# flutter_desktop_integration_test_dev:
#   stage: frontend
#   trigger:
#     include: tools/pipelines/frontend/child-ci-flutter-desktop-integration-test-dev.yml

# flutter_games_integration_test_dev:
#   stage: frontend
#   trigger:
#     include: tools/pipelines/frontend/child-ci-flutter-games-integration-test.yml

# flutter_mobile_integration_test_dev:
#   stage: frontend
#   trigger:
#     include: tools/pipelines/frontend/child-ci-flutter-mobile-integration-test-dev.yml

# flutter_web_integration_test_dev:
#   stage: frontend
#   trigger:
#     include: tools/pipelines/frontend/child-ci-flutter-web-integration-test-dev.yml

# react_integration_test_dev:
#   stage: frontend
#   trigger:
#     include: tools/pipelines/frontend/child-ci-react-integration-test-dev.yml

# svelte_integration_test_dev:
#   stage: frontend
#   trigger:
#     include: tools/pipelines/frontend/child-ci-svelte-integration-test-dev.yml

# vue_integration_test_dev:
#   stage: frontend
#   trigger:
#     include: tools/pipelines/frontend/child-ci-vue-integration-test-dev.yml
